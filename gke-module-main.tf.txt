module "cluster" {
  for_each = {
    for k, v in try(var.cluster, {}) : k => v if v.delete!= true
  }
  source                                   = "git::https://github.com/QDXEnterpriseOrg/dso-gcpfoundation-iac-module-gke.git//terraform-google-kubernetes-engine?ref=v1.0.0"
 # delete                                   = each.value.delete
  name                                     = each.value.name
  random_suffix                            = each.value.random_suffix
  location                                 = each.value.location
  project_id                               = each.value.project_id
  deletion_protection                      = each.value.deletion_protection
  node_locations                           = each.value.node_locations
  addons_config                            = each.value.addons_config
  network                                  = each.value.network
  subnetwork                               = each.value.subnetwork
  allow_net_admin                          = each.value.allow_net_admin
  cluster_ipv4_cidr                        = each.value.cluster_ipv4_cidr
  datapath_provider                        = each.value.datapath_provider
  release_channel                          = each.value.release_channel
  #cluster_telemetry                        = each.value.cluster_telemetry
  gateway_api_config                       = each.value.gateway_api_config
  enable_kubernetes_alpha                  = each.value.enable_kubernetes_alpha
  enable_tpu                               = each.value.enable_tpu
  enable_legacy_abac                       = each.value.enable_legacy_abac
  networking_mode                          = each.value.networking_mode
 # node_version                             = each.value.node_version
  resource_labels                          = each.value.resource_labels
  enable_intranode_visibility              = each.value.enable_intranode_visibility
  enable_l4_ilb_subsetting                 = each.value.enable_l4_ilb_subsetting
  enable_multi_networking                  = each.value.enable_multi_networking
  private_ipv6_google_access               = each.value.private_ipv6_google_access
  enable_cilium_clusterwide_network_policy = each.value.enable_cilium_clusterwide_network_policy
  remove_default_node_pool                 = each.value.remove_default_node_pool
  cost_management_config                   = each.value.cost_management_config
  resource_usage_export_config             = each.value.resource_usage_export_config
  confidential_nodes                       = each.value.confidential_nodes
  default_snat_status                      = each.value.default_snat_status
  cluster_autoscaling                      = each.value.cluster_autoscaling
  master_auth                              = each.value.master_auth
  logging_config                           = each.value.logging_config
  logging_service                          = each.value.logging_service
  monitoring_config                        = each.value.monitoring_config
  monitoring_service                       = each.value.monitoring_service
  security_posture_config                  = each.value.security_posture_config
  vertical_pod_autoscaling                 = each.value.vertical_pod_autoscaling
  fleet                                    = each.value.fleet
  ip_allocation_policy                     = each.value.ip_allocation_policy
  service_external_ips_config              = each.value.service_external_ips_config
  mesh_certificates                        = each.value.mesh_certificates
  database_encryption                      = each.value.database_encryption
  binary_authorization                     = each.value.binary_authorization
  identity_service_config                  = each.value.identity_service_config
  maintenance_policy                       = each.value.maintenance_policy
  dns_config                               = each.value.dns_config
 # min_master_version                       = each.value.min_master_version
  default_max_pods_per_node                = each.value.default_max_pods_per_node
  enable_k8s_beta_apis                     = each.value.enable_k8s_beta_apis
  master_authorized_networks_config        = each.value.master_authorized_networks_config
  enable_shielded_nodes                    = each.value.enable_shielded_nodes
 # enable_autopilot                         = each.value.enable_autopilot
  initial_node_count                       = each.value.initial_node_count
 # services_ipv4_cidr_block                 = each.value.services_ipv4_cidr_block
 # cluster_ipv4_cidr_block                  = each.value.cluster_ipv4_cidr_block
 # additional_pod_ranges_config             = each.value.additional_pod_ranges_config
 # stack_type                               = each.value.stack_type
  network_policy                           = each.value.network_policy
  node_config                              = each.value.node_config
  node_pool                                = each.value.node_pool
  node_pool_auto_config                    = each.value.node_pool_auto_config
  notification_config                      = each.value.notification_config
  node_pool_defaults                       = each.value.node_pool_defaults
 # pod_security_policy_config               = each.value.pod_security_policy_config
  authenticator_groups_config              = each.value.authenticator_groups_config
  private_cluster_config                   = each.value.private_cluster_config
  workload_identity_config                 = each.value.workload_identity_config
 # protect_config                           = each.value.protect_config
 # workload_alts_config                     = each.value.workload_alts_config
}